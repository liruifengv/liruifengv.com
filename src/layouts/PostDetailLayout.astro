---
import { type CollectionEntry, getCollection } from 'astro:content';

import BaseLayout from '../layouts/BaseLayout.astro';
import ContactCTA from '../components/ContactCTA.astro';
import Tag from '../components/Tag.astro';
import Comments from "@components/Comment";
import { formatDate } from "@utils/date.ts";
import OpenclawGroup from "@assets/images/openclaw-prompts/wechat-group.jpg"
import { Image } from 'astro:assets';

interface Props {
	post: CollectionEntry<'posts'>;
}

export async function getStaticPaths() {
	const posts = await getCollection('posts');
	return posts.map((entry) => ({
		params: { slug: entry.slug },
		props: { entry },
	}));
}

const { post } = Astro.props;

const { title, author, description, ogImage, canonicalURL, pubDatetime, tags } = post.data;

const { Content, remarkPluginFrontmatter } = await post.render();

const { readingTime, words } = remarkPluginFrontmatter;

const ogImageUrl = typeof ogImage === "string" ? ogImage : ogImage?.src;
const ogUrl = new URL(ogImageUrl ?? `/posts/${post.slug}.png`, Astro.url.origin).href;
---

<BaseLayout
	title={title + ' | ' + 'liruifengv'}
	author={author}
	description={description}
	ogImage={ogUrl}
	canonicalURL={canonicalURL}
>
	<div class="post-page">
		<!-- Article Header -->
		<header class="post-header">
			<div class="wrapper">
				<div class="header-content">
					<h1 class="post-title">{title}</h1>

					<div class="post-meta">
						<span class="meta-item">å‘å¸ƒäºï¼š{formatDate(pubDatetime)}</span>
						<span class="meta-divider">Â·</span>
						<span class="meta-item">{words}</span>
						<span class="meta-divider">Â·</span>
						<span class="meta-item">{readingTime}</span>
					</div>

					<div class="post-tags">
						{tags.map((t) => <Tag name={t} />)}
					</div>
				</div>
			</div>
		</header>

		<!-- Article Content -->
		<main class="post-content">
			<div class="wrapper">
				<article
					id="article"
					role="article"
					class="article-body prose prose-lg dark:prose-invert max-w-3xl mx-auto"
				>
					<Content />

					<!-- Author CTA -->
					<div class="author-cta">
						<p>
							åŠ æˆ‘å¾®ä¿¡ <code>liruifengv2333</code>ï¼Œè¿›ç¾¤äº¤æµï¼ŒæŠ±å›¢å–æš–ã€‚
						</p>

						<ul>
							<li>AI Agent å¼€å‘äº¤æµç¾¤ï¼ˆå­¦ä¹  Agent å¼€å‘ï¼ŒæŠ€æœ¯åŒå­¦è¿›ï¼‰</li>
							<li>Astro å­¦ä¹ äº¤æµç¾¤ï¼ˆä½¿ç”¨ Astro å¼€å‘ç½‘ç«™çš„åŒå­¦è¿›ï¼‰</li>
							<li>
    						    OpenClaw ğŸ¦äº¤æµç¾¤
    							<Image src={OpenclawGroup} alt="OpenClaw ğŸ¦äº¤æµç¾¤" width={200}/>
    						</li>
						</ul>
						<p>å…³æ³¨å…¬ä¼—å· <code>ç‘ä¸°åŒå­¦</code>ï¼Œå¸¦æ¥æ›´å¤šåŸåˆ›å†…å®¹ã€‚</p>
						<img
							src="https://bucket.liruifengv.com/qrcode.png?v=2"
							alt="å…¬ä¼—å·äºŒç»´ç "
							class="qrcode"
						/>
						<p class="welcome-text">å¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæ¬¢è¿æ¥ç©å„¿~</p>
					</div>

					<Comments client:only="react" />
				</article>
			</div>
		</main>

		<ContactCTA />
	</div>
</BaseLayout>

<style>
	.post-page {
		display: flex;
		flex-direction: column;
	}

	/* Header */
	.post-header {
		padding: 2rem 0 1.5rem;
		border-bottom: 1px solid var(--border);
	}

	.header-content {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 1.25rem;
		text-align: center;
	}

	.post-title {
		font-family: var(--font-brand);
		font-size: var(--text-2xl);
		font-weight: 700;
		color: var(--foreground);
		line-height: 1.3;
		max-width: 28ch;
	}

	.post-meta {
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
		gap: 0.5rem;
		color: var(--muted-foreground);
		font-size: var(--text-sm);
	}

	.meta-divider {
		opacity: 0.5;
	}

	.post-tags {
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
		gap: 0.5rem;
	}

	/* Content */
	.post-content {
		padding: 3rem 0;
	}

	.article-body {
		color: var(--muted-foreground);
		line-height: 1.8;
	}

	.article-body :global(h1),
	.article-body :global(h2),
	.article-body :global(h3),
	.article-body :global(h4) {
		font-family: var(--font-brand);
		color: var(--foreground);
		margin-top: 2.5rem;
		margin-bottom: 1rem;
	}

	.article-body :global(p) {
		margin-bottom: 1.5rem;
	}

	.article-body :global(a) {
		color: var(--primary);
		text-decoration: underline;
		text-underline-offset: 2px;
	}

	.article-body :global(a:hover) {
		color: var(--secondary);
	}

	.article-body :global(code) {
		background: rgba(93, 112, 82, 0.1);
		color: var(--primary);
		padding: 0.125rem 0.375rem;
		border-radius: 0.25rem;
		font-size: 0.9em;
	}

	.article-body :global(pre) {
		background: #1e1e1e !important;
		border-radius: var(--radius-lg);
		padding: 1.5rem;
		margin: 1.5rem 0;
		overflow-x: auto;
	}

	.article-body :global(pre code) {
		background: transparent;
		padding: 0;
		color: #d4d4d4;
	}

	.article-body :global(blockquote) {
		border-left: 3px solid var(--primary);
		background: var(--muted);
		padding: 1rem 1.5rem;
		border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
		margin: 1.5rem 0;
	}

	.article-body :global(img) {
		border-radius: var(--radius-lg);
		margin: 1.5rem 0;
	}

	.article-body :global(ul),
	.article-body :global(ol) {
		padding-left: 1.5rem;
		margin-bottom: 1.5rem;
	}

	.article-body :global(li) {
		margin-bottom: 0.5rem;
	}

	/* Author CTA */
	.author-cta {
		margin-top: 3rem;
		padding: 2rem;
		background: var(--muted);
		border-radius: var(--radius-2xl);
		border: 1px solid var(--border);
	}

	.author-cta :global(code) {
		background: var(--background);
	}

	.qrcode {
		height: 8rem;
		width: auto;
		margin: 1rem 0;
	}

	.welcome-text {
		color: var(--primary);
		font-weight: 500;
	}

	@media (min-width: 50em) {
		.post-header {
			padding: 4rem 0 3rem;
		}

		.post-title {
			font-size: var(--text-3xl);
		}

		.post-content {
			padding: 4rem 0;
		}
	}
</style>

<style is:global>
	/* Override prose styles for better integration */
	.prose {
		--tw-prose-body: var(--muted-foreground);
		--tw-prose-headings: var(--foreground);
		--tw-prose-links: var(--primary);
		--tw-prose-bold: var(--foreground);
		--tw-prose-quotes: var(--foreground);
		--tw-prose-quote-borders: var(--primary);
		--tw-prose-code: var(--primary);
	}
</style>
